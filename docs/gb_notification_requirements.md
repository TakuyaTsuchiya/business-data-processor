# ガレージバンク催告書 契約者 - 要件定義書

## 概要
ガレージバンク催告書YYMMDD.xlsxを生成する機能。
書面で送付するリストのため、住所が不明な契約者は除外する。

## 入力ファイル

### 1. ContractList_*.csv
- 契約者データ（121列）
- エンコーディング: cp932 / shift_jis / utf-8-sig（自動判定）

### 2. 情報連携シート_*.xlsx
- 01_請求データシートのみ使用
- カラム: ユーザーID, 請求金額, 遅延損害金額, その他費用

## マッチング処理

| 項目 | 詳細 |
|------|------|
| ContractList側キー | 引継番号（B列=1列目） |
| 情報連携シート側キー | ユーザーID（0列目） |
| マッチ時 | 請求金額、遅延損害金額、その他費用を追加 |
| 非マッチ時 | 出力から除外 |

## フィルタ条件

| フィルタ項目 | 条件 | 列位置（0始まり） |
|------------|------|-----------------|
| 委託先法人ID | = 7 | 118列目 |
| 入金予定日 | < 本日（空白含む） | 72列目 |
| 滞納残債 | >= 1円 | 71列目 |
| 入金予定金額 | 2, 3, 5を除外 | 73列目 |
| 回収ランク | 死亡決定, 破産決定, 弁護士介入を除外 | 86列目 |
| 住所 | 郵便番号・現住所1-3が全て入力済 | 22,23,24,25列目 |
| 入居ステータス | フィルタなし | - |

## 出力カラム（22列）

| No | カラム名 | データソース | 列位置 |
|----|---------|-------------|-------|
| 1 | 管理番号 | ContractList | 0 |
| 2 | 契約者氏名 | ContractList | 20 |
| 3 | 郵便番号 | ContractList | 22 |
| 4 | 現住所1 | ContractList | 23 |
| 5 | 現住所2 | ContractList | 24 |
| 6 | 現住所3 | ContractList | 25 |
| 7 | 滞納残債 | ContractList | 71 |
| 8 | 請求金額 | 情報連携シート | - |
| 9 | 遅延損害金額 | 情報連携シート | - |
| 10 | その他費用 | 情報連携シート | - |
| 11 | 物件住所1 | ContractList | 92 |
| 12 | 物件住所2 | ContractList | 93 |
| 13 | 物件住所3 | ContractList | 94 |
| 14 | 物件名 | ContractList | 95 |
| 15 | 物件番号 | ContractList | 96 |
| 16 | 回収口座銀行CD | ContractList | 34 |
| 17 | 回収口座銀行名 | ContractList | 35 |
| 18 | 回収口座支店CD | ContractList | 36 |
| 19 | 回収口座支店名 | ContractList | 37 |
| 20 | 回収口座種類 | ContractList | 38 |
| 21 | 回収口座番号 | ContractList | 39 |
| 22 | 回収口座名義人 | ContractList | 40 |

## 出力ファイル

- ファイル名: `ガレージバンク催告書YYMMDD.xlsx`（YYMMDDは処理実行日）
- 形式: XLSX（Excel 2007+）
- フォント: 游ゴシック 12pt

## UI仕様

- ボタン名: 「ガレージバンク催告書 契約者 差し込みリスト」
- 配置: フェイスメニュー内「ガレージバンク」セクション
- ファイルアップロード: 2つ（ContractList + 情報連携シート）
- フィルタ条件表示: Expander内に表示
- 処理ログ: Expander内に詳細ログ表示
- 結果プレビュー: 先頭10件を表示

## 処理フロー

```
1. ContractList_*.csv 読み込み
2. 情報連携シート_*.xlsx 読み込み（01_請求データ）
3. 引継番号 ↔ ユーザーID でマッチング
4. マッチしないデータを除外
5. 共通フィルタ適用
   - 委託先法人ID = 7
   - 入金予定日 < 本日
   - 滞納残債 >= 1円
   - 入金予定金額 != 2,3,5
   - 回収ランク != 死亡決定,破産決定,弁護士介入
6. 住所フィルタ（郵便番号・現住所1-3が全て入力済）
7. 出力カラムマッピング
8. XLSX出力
```

---
作成日: 2026-01-22

# Docker 基礎知識ガイド

## 🐳 Docker とは？

Docker（ドッカー）は、アプリケーションを「コンテナ」という箱に入れて、
どのコンピュータでも同じように動かせるようにする技術です。

### 身近な例で理解する Docker

**引っ越しの例**:
- 従来: 家具を一つずつ運ぶ（環境構築が大変）
- Docker: 引っ越しコンテナにすべて入れて運ぶ（簡単に移動）

**お弁当の例**:
- 従来: 材料を持って行って現地で調理（環境依存）
- Docker: お弁当箱に入れて持っていく（どこでも同じ）

---

## 📦 コンテナとは？

コンテナは、アプリケーションとその実行に必要なものすべてを
パッケージ化した「箱」です。

### コンテナに含まれるもの
- アプリケーション本体（Business Data Processor）
- 必要なプログラム（Python、Streamlit など）
- 設定ファイル
- 日本語環境設定

### コンテナのメリット
1. **環境非依存**: Windows でも Mac でも Linux でも動く
2. **簡単配布**: ファイル一式コピーするだけ
3. **環境分離**: 他のアプリに影響しない
4. **バージョン管理**: 複数バージョンを同時に使える

---

## 🖼️ イメージとコンテナの違い

### イメージ（Image）
- アプリケーションの「設計図」や「レシピ」
- 読み取り専用
- 何度でも同じコンテナを作れる

### コンテナ（Container）
- イメージから作られた「実行中のアプリ」
- 起動・停止・削除が可能
- データの読み書きが可能

**例**: 
- イメージ = ケーキのレシピ
- コンテナ = レシピから作った実際のケーキ

---

## 🏗️ Docker の仕組み

### 3つの主要コンポーネント

1. **Docker Desktop**
   - Docker を Windows で使うためのアプリ
   - GUI（画面）で操作可能
   - コンテナの管理ツール

2. **Docker Engine**
   - コンテナを実際に動かすエンジン
   - バックグラウンドで動作

3. **Docker Hub**
   - イメージを保存・共有する場所
   - 公式イメージが多数公開されている

---

## 📁 Business Data Processor での Docker 構成

### ファイル構成
```
business-data-processor/
├── Dockerfile           # イメージの設計図
├── docker-compose.yml   # 起動設定
├── app.py              # アプリ本体
└── processors/         # 処理モジュール
```

### Dockerfile の役割
```dockerfile
FROM python:3.11-slim    # ベースとなるイメージ
WORKDIR /app            # 作業フォルダ
COPY app.py .           # ファイルをコピー
RUN pip install ...     # 必要なものをインストール
CMD ["streamlit", ...]  # 起動コマンド
```

### docker-compose.yml の役割
- 複雑な Docker コマンドを簡単に
- ポート設定、ボリューム設定を定義
- 環境変数の設定

---

## 💾 データの永続化（ボリューム）

### 問題
コンテナを削除するとデータも消える

### 解決策: ボリュームマウント
```yaml
volumes:
  - ./data:/app/data         # ローカルの data フォルダ
  - ./downloads:/app/downloads # ダウンロードフォルダ
```

**メリット**:
- コンテナを削除してもデータは残る
- ホストPCから直接アクセス可能
- バックアップが簡単

---

## 🔧 よく使う Docker コマンド

### 基本コマンド（バッチファイルで自動化済み）

| 操作 | コマンド | バッチファイル |
|------|----------|----------------|
| 起動 | `docker-compose up -d` | 🚀起動.bat |
| 停止 | `docker-compose down` | 🛑停止.bat |
| ログ | `docker-compose logs` | 📊ログ確認.bat |
| 再起動 | `docker-compose restart` | 🔄再起動.bat |

### 便利なコマンド

**コンテナの状態確認**:
```bash
docker ps
```

**イメージ一覧**:
```bash
docker images
```

**ディスク使用量確認**:
```bash
docker system df
```

**クリーンアップ**:
```bash
docker system prune -a
```

---

## 🌐 ネットワークとポート

### ポートマッピング
```yaml
ports:
  - "8501:8501"
  #  ↑ホスト側 : コンテナ側↓
```

- **ホスト側**: あなたのPCでアクセスするポート
- **コンテナ側**: アプリが使用するポート

### アクセス方法
- `http://localhost:8501`
- `localhost` = 自分のPC
- `8501` = ポート番号

---

## 🔒 セキュリティ

### Docker のセキュリティ機能
1. **分離環境**: 他のアプリと干渉しない
2. **権限制御**: 必要最小限の権限で実行
3. **ネットワーク分離**: 専用ネットワーク使用

### Business Data Processor の対策
- 非rootユーザーで実行
- 必要最小限のパッケージのみインストール
- ローカル実行のみ（外部公開なし）

---

## 📈 パフォーマンス

### リソース制限
```yaml
deploy:
  resources:
    limits:
      cpus: '2'      # CPU 2コアまで
      memory: 1G     # メモリ 1GBまで
```

### チューニングのヒント
1. メモリを増やす → 大量データ処理が高速化
2. CPU を増やす → 並列処理が高速化
3. 不要なコンテナを削除 → ディスク容量確保

---

## 🎯 まとめ

### Docker を使う理由
1. **簡単**: 環境構築不要
2. **確実**: どこでも同じ動作
3. **安全**: 他のアプリに影響なし
4. **便利**: 配布・共有が簡単

### Business Data Processor での利点
- Python環境の構築不要
- 文字化け問題の解消
- バージョン管理が簡単
- 複数PCでの利用が可能

### 次のステップ
1. Docker Desktop をインストール
2. Business Data Processor を起動
3. 快適なデータ処理を体験！

---

## 📚 さらに学びたい方へ

### 公式ドキュメント
- [Docker 公式サイト](https://www.docker.com/)
- [Docker 日本語ドキュメント](https://docs.docker.jp/)

### おすすめの学習順序
1. コンテナの概念を理解
2. 基本的なコマンドを覚える
3. Dockerfile を読めるようになる
4. docker-compose.yml を理解する
5. 自分でコンテナを作ってみる
# Business Data Processor v2.3.0

[![CI/CD Status](https://github.com/TakuyaTsuchiya/business-data-processor/workflows/Deploy%20to%20Production/badge.svg)](https://github.com/TakuyaTsuchiya/business-data-processor/actions)

**統合データ処理システム** - 革新的UIシステム搭載版

> 本番環境復旧確認中...

## 🌟 概要

複数の業務用データ処理アプリケーションを統合した、**革新的なプルダウンレスUI**を搭載したStreamlit製のWebアプリケーションです。不動産管理業務における契約データの変換・統合処理を自動化し、**常時表示階層メニュー**による直感的で効率的な操作を実現した業務効率化ツールです。

## 📊 対応プロセッサー（17種類完全統合）

### 📞 オートコール用CSV加工（12種類）

#### ミライル用オートコール（6種類）
- **契約者（10,000円を除外するパターン）**: 1万円・1万1千円を自動除外
- **契約者（10,000円を除外しないパターン）**: 残債除外なしで全件処理
- **保証人（残債除外）**: 保証人電話番号での処理（残債除外）
- **保証人（残債含む）**: 保証人電話番号での処理（残債含む）
- **緊急連絡人（残債除外）**: 緊急連絡人電話番号での処理（残債除外） 
- **緊急連絡人（残債含む）**: 緊急連絡人電話番号での処理（残債含む）

#### 📱 フェイスオートコール（3種類）
- **契約者**: 委託先法人ID（1-4）でフィルタリング
- **保証人**: フェイス委託先の保証人データ処理
- **緊急連絡人**: フェイス委託先の緊急連絡人データ処理

#### 🏪 プラザオートコール（3種類）
- **契約者**: 2ファイル処理（ContractList + Excel報告書）
- **保証人**: 基本構造実装済み（要完成化）
- **緊急連絡人**: 2ファイル処理対応

### 📋 データ変換（2種類）
#### 🏗️ アーク新規登録
- **機能**: 案件取込用レポート + ContractList の統合処理
- **特徴**: 111列統合CSV生成、住所分割、保証人判定自動化
- **用途**: アーク新規登録用データ完全変換

#### 🏢 カプコ新規登録
- **機能**: カプコレポート + ContractList の統合処理
- **特徴**: CAP-プレフィックス管理番号、住所分割、処理費用計算自動化
- **用途**: カプコ新規登録用データ完全変換

### 📱 SMS処理（2種類）
#### 📱 フェイスSMS退去済み契約者
- **機能**: ContractList*.csvから退去済み契約者SMS送信用データ生成
- **フィルタリング**: 委託先法人ID（1-4）、入金予定日、金額（2,3,5除外）、回収ランク、携帯番号
- **出力形式**: 59列構造（電話番号、契約者名、物件名、金額、銀行口座、メモ + 50空白列 + 保証人/連絡人/支払期限）
- **文字化け対策**: chardet自動検出 + CP932出力統一

#### 🔔 フェイスSMS（準備中）
- **実装枠**: 将来拡張用として準備済み

## 🚀 主な機能

### 共通機能
- ✅ **ファイルアップロード**: ドラッグ&ドロップ対応
- ✅ **自動エンコーディング判定**: UTF-8, Shift_JIS, CP932に対応
- ✅ **リアルタイム処理ログ**: 詳細な処理状況表示
- ✅ **データプレビュー**: 処理結果の即座確認
- ✅ **CSVダウンロード**: CP932エンコーディングで出力
- ✅ **統計情報表示**: データ品質・件数・内訳の表示

### ミライル契約者処理
- 委託先法人ID（空白と5）フィルタリング
- 残債10,000円・11,000円の自動除外
- 電話番号の最適化処理

### フェイス契約者処理  
- 委託先法人ID（1,2,3,4）でフィルタリング
- 回収ランク除外（死亡決定、破産決定、弁護士介入）
- 委託先別内訳の可視化

### アーク新規登録処理
- 重複データの自動除外（ContractListとの照合）
- 住所の自動分割（都道府県・市区町村・残り住所）
- 物件名から部屋番号の自動抽出
- 電話番号処理（自宅TEL→携帯TEL移動）
- 保証人・緊急連絡人の自動判定
- 退去手続き費用の自動計算（最低70,000円保証）
- 引継情報の自動生成

## 💻 技術仕様

### 開発環境
- **言語**: Python 3.8+
- **フレームワーク**: Streamlit 1.28+
- **データ処理**: pandas 2.0+, chardet 5.2+
- **UI自動化**: Playwright 1.40+（テスト用）
- **対応OS**: Windows, macOS, Linux

### アーキテクチャ
```
business-data-processor/
├── app.py                    # メインStreamlitアプリ

└── README.md                 # このファイル
```

## 🧪 テスト・品質保証

### UIテスト環境
- **Playwright**: ブラウザ自動化テスト
- **スクリーンショット取得**: 各画面の動作確認
- **自動化テスト**: UI操作の検証

### データ品質保証
- **エンコーディング自動検出**: 文字化け防止
- **データ検証**: 必須項目・形式チェック
- **エラーハンドリング**: 詳細なエラーメッセージ表示
- **処理ログ**: 全処理過程の可視化

## 🔒 セキュリティ

- **ローカル実行**: データが外部に送信されない
- **一時的処理**: アップロードファイルは処理後に破棄
- **エンコーディング対応**: 日本語データの正確な処理

## 📈 パフォーマンス

- **処理速度**: 約1,000件/10秒
- **メモリ使用量**: 約100MB（1,000件処理時）
- **ファイルサイズ**: 30MB以下のCSVファイルに対応
- **同時処理**: シングルスレッド（データ整合性重視）

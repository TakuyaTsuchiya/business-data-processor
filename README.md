# Business Data Processor

**統合データ処理システム** - CSVデータの自動変換・フィルタリング・統合処理ツール

## 🌟 概要

複数の業務用データ処理アプリケーションを統合した、Streamlit製のWebアプリケーションです。不動産管理業務における契約データの変換・統合処理を自動化し、業務効率を大幅に向上させます。

## 🔧 対応システム（業務カテゴリ別）

### 📞 オートコール処理
#### 🏢 ミライル
- **残債除外版**: 残債1万円・1万1千円を自動除外してオートコール用CSV生成
- **残債含む版**: 残債除外なしで全件処理、オートコール用CSV生成

#### 📱 フェイス  
- **標準版**: 委託先法人ID（1-4）でフィルタリング、オートコール用CSV生成

#### 🏪 プラザ（準備中）
- **標準版**: プラザ向けオートコール処理（将来実装予定）

### 📱 SMS処理
#### 🔔 フェイスSMS（準備中）
- **標準版**: SMS送信用データ処理（将来実装予定）

### 📋 アーク新規登録
- **概要**: 案件取込用レポートとContractListを統合
- **用途**: アーク新規登録用の統合CSVファイル生成
- **特徴**: 複雑なデータ変換・住所分割・保証人判定を自動化

## 🚀 主な機能

### 共通機能
- ✅ **ファイルアップロード**: ドラッグ&ドロップ対応
- ✅ **自動エンコーディング判定**: UTF-8, Shift_JIS, CP932に対応
- ✅ **リアルタイム処理ログ**: 詳細な処理状況表示
- ✅ **データプレビュー**: 処理結果の即座確認
- ✅ **CSVダウンロード**: CP932エンコーディングで出力
- ✅ **統計情報表示**: データ品質・件数・内訳の表示

### ミライル契約者処理
- 委託先法人ID空白のみフィルタリング
- 残債10,000円・11,000円の自動除外
- 電話番号の最適化処理

### フェイス契約者処理  
- 委託先法人ID（1,2,3,4）でフィルタリング
- 回収ランク除外（死亡決定、破産決定、弁護士介入）
- 委託先別内訳の可視化

### アーク新規登録処理
- 重複データの自動除外（ContractListとの照合）
- 住所の自動分割（都道府県・市区町村・残り住所）
- 物件名から部屋番号の自動抽出
- 電話番号処理（自宅TEL→携帯TEL移動）
- 保証人・緊急連絡人の自動判定
- 退去手続き費用の自動計算（最低70,000円保証）
- 引継情報の自動生成

## 💻 技術仕様

### 開発環境
- **言語**: Python 3.8+
- **フレームワーク**: Streamlit 1.28+
- **データ処理**: pandas 2.0+, chardet 5.2+
- **UI自動化**: Playwright 1.40+（テスト用）
- **対応OS**: Windows, macOS, Linux

### アーキテクチャ
```
business-data-processor/
├── app.py                    # メインStreamlitアプリ
├── start.bat                 # ワンクリック起動バッチ
├── requirements.txt          # 依存パッケージ
├── processors/               # 業務別処理モジュール
│   ├── mirail_autocall/      # ミライルオートコール
│   │   ├── standard.py       # 残債除外版
│   │   └── with_debt.py      # 残債含む版
│   ├── faith_autocall/       # フェイスオートコール
│   │   └── standard.py       # 標準版
│   ├── plaza_autocall/       # プラザオートコール（準備中）
│   │   └── standard.py       # 標準版
│   ├── faith_sms/            # フェイスSMS（準備中）
│   │   └── standard.py       # 標準版
│   └── ark_registration.py   # アーク新規登録
├── shared/                   # 共通ユーティリティ
├── templates/                # テンプレートファイル
├── screenshots/              # UIテスト用スクリーンショット
└── README.md                 # このファイル
```

## 🛠️ インストール・セットアップ

### 1. リポジトリのクローン
```bash
git clone https://github.com/TakuyaTsuchiya/business-data-processor.git
cd business-data-processor
```

### 2. 依存パッケージのインストール
```bash
pip install -r requirements.txt
```

### 3. アプリケーションの起動
```bash
streamlit run app.py
```

ブラウザで http://localhost:8501 にアクセスしてアプリを使用してください。

## 📖 使用方法

### 基本的な使い方

1. **ブラウザでアプリにアクセス**
2. **左サイドバーから業務カテゴリ選択**
   - 📞 オートコール処理 → 🏢 ミライル / 📱 フェイス / 🏪 プラザ
   - 📱 SMS処理 → 🔔 フェイスSMS
   - 📋 アーク新規登録
3. **必要なCSVファイルをアップロード**
4. **🚀 処理開始ボタンをクリック**
5. **結果確認後、CSVファイルをダウンロード**

### 各プロセッサーの詳細使用方法

#### ミライル契約者
```
必要ファイル: ContractList_*.csv
出力ファイル: MMDDミライル_without10k_契約者.csv
```

#### フェイス契約者
```
必要ファイル: ContractList_*.csv
出力ファイル: MMDDフェイス_契約者.csv
```

#### アーク新規登録
```
必要ファイル: 
- 【東京支店】①案件取込用レポート*.csv
- ContractList_*.csv
出力ファイル: MMDDアーク新規登録.csv
```

## 🧪 テスト・品質保証

### UIテスト環境
- **Playwright**: ブラウザ自動化テスト
- **スクリーンショット取得**: 各画面の動作確認
- **自動化テスト**: UI操作の検証

### データ品質保証
- **エンコーディング自動検出**: 文字化け防止
- **データ検証**: 必須項目・形式チェック
- **エラーハンドリング**: 詳細なエラーメッセージ表示
- **処理ログ**: 全処理過程の可視化

## 🔒 セキュリティ

- **ローカル実行**: データが外部に送信されない
- **一時的処理**: アップロードファイルは処理後に破棄
- **エンコーディング対応**: 日本語データの正確な処理

## 📈 パフォーマンス

- **処理速度**: 約1,000件/10秒
- **メモリ使用量**: 約100MB（1,000件処理時）
- **ファイルサイズ**: 10MB程度のCSVファイルに対応
- **同時処理**: シングルスレッド（データ整合性重視）

## 🤝 貢献・開発

### 開発者向け情報

#### ローカル開発環境
```bash
# 開発用依存関係インストール
pip install -r requirements.txt

# Playwrightブラウザインストール（UIテスト用）
python -m playwright install

# アプリ起動
streamlit run app.py --server.port 8501
```

#### 新しいプロセッサーの追加
1. `processors/` ディレクトリに新しいプロセッサーを作成
2. `app.py` にUI処理を追加
3. ユニットテストを実装
4. ドキュメントを更新

### コード品質
- **モジュール化設計**: 各処理が独立したモジュール
- **エラーハンドリング**: 包括的な例外処理
- **ログ出力**: 詳細な処理ログ
- **型ヒント**: Pythonの型アノテーション使用

## 📋 更新履歴

### v2.1.0 (2025/07/28)
- 🎉 プラザオートコール3種類実装完了（契約者/保証人/緊急連絡人）
- ✅ 2ファイル処理対応（ContractList + Excel報告書）
- ✅ 合計15種類のプロセッサーを統合した完全版アプリ
- ✅ フラットメニュー構造で操作性向上

### v2.0.0 (2025/07/28)
- 🎉 業務カテゴリ別の階層メニュー構造に刷新
- 📁 プロセッサーディレクトリの業務別再編成
- 🚀 将来拡張を見据えた設計（プラザ・SMS対応枠）
- ✅ start.batによるワンクリック起動実現

### v1.1.0 (2025/07/28)
- ✅ ミライル契約者（残債含む全件）プロセッサー追加
- ✅ メニュー表示の改善（より分かりやすい表記）
- ✅ 4つのプロセッサーによる完全統合アプリ実現

### v1.0.0 (2025/07/28)
- 🎉 統合アプリケーション初回リリース
- ✅ ミライル契約者プロセッサー実装
- ✅ フェイス契約者プロセッサー実装  
- ✅ アーク新規登録プロセッサー実装
- ✅ StreamlitによるWebUI実装
- ✅ PlaywrightによるUIテスト環境構築

## 🆘 トラブルシューティング

### よくある問題

#### 1. エンコーディングエラー
```
UnicodeDecodeError: 'cp932' codec can't decode...
```
**解決策**: ファイルがCP932でエンコードされているか確認。BOM付きUTF-8の場合は自動変換されます。

#### 2. モジュールインポートエラー
```
ImportError: No module named 'processors.xxx'
```
**解決策**: `pip install -r requirements.txt` で依存関係を再インストール。

#### 3. Streamlit起動エラー
```
Port 8501 is already in use
```
**解決策**: 別のポートを指定 `streamlit run app.py --server.port 8502`

### サポート
- **GitHub Issues**: [business-data-processor/issues](https://github.com/TakuyaTsuchiya/business-data-processor/issues)
- **ドキュメント**: 本READMEファイル

## 📄 ライセンス

このプロジェクトは内部使用を目的としています。

## 👥 作成者

- **開発者**: Takuya Tsuchiya
- **AI支援**: Claude Code (Anthropic)
- **プロジェクト期間**: 2025年7月

---

**Business Data Processor** - 業務効率化のための統合データ処理システム
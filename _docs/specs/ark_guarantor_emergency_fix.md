# アーク新規登録 保証人/緊急連絡人の列名対応修正

## 概要

アーク新規登録で保証人/緊急連絡人が出力されない問題を修正する。

## 問題

1. **列名の不一致**: コードが参照する列名と実際の入力CSVの列名が異なる
2. **名前3の未対応**: 名前2が空で名前3にデータがある場合、拾えない

## 原因詳細

### 列名の差異

| コードの列名 | 実際の入力CSV | 差異 |
|------------|--------------|------|
| `名前2` | `氏名2` | 名前 vs 氏名 |
| `名前2（カナ）` | `氏名2(カナ)` | 全角括弧 vs 半角括弧 |
| `種別／続柄２` | `種別／続柄2` | 全角２ vs 半角2 |

### 入力データの実態

- **川森あゆみ**: 名前2が空、名前3に緊急連絡先（川森郁代）
- **丹羽永吉**: 名前2に保証人（丹羽進二）、名前3は空

## 確定仕様

1. **列名は新旧両形式に対応**
   - 新形式: `氏名2`, `氏名2(カナ)`, `種別／続柄2`（半角）
   - 旧形式: `名前2`, `名前2（カナ）`, `種別／続柄２`（全角）

2. **名前2が空欄で名前3に値がある場合** → 名前3を拾う

3. **名前2と名前3の両方に値がある場合** → 名前2のみ出力、名前3は無視

## 対象ファイル

- `processors/ark_registration.py`

## 修正内容

### 1. ヘルパー関数追加

新旧両形式の列名に対応して値を取得する関数を追加：

```python
def get_column_value(self, row: pd.Series, new_key: str, old_key: str) -> str:
    """新旧両方の列名に対応して値を取得"""
    value = self.safe_str_convert(row.get(new_key, ""))
    if not value:
        value = self.safe_str_convert(row.get(old_key, ""))
    return value
```

### 2. process_guarantor_emergency関数の修正

- 列名を新旧両形式対応に変更
- 名前3の処理を追加（名前2が空の場合のみ処理）

### 3. デバッグ用print文の削除

本番環境に不要なprint文を削除。

## テストケース

1. 新形式（氏名2、半角括弧）で保証人が取得できる
2. 旧形式（名前2、全角括弧）で保証人が取得できる
3. 名前2が空、名前3に緊急連絡先がある場合、緊急連絡人1に出力される
4. 名前2に保証人、名前3に緊急連絡先がある場合、保証人1のみ出力される

## 期待される結果

- **29142034（川森あゆみ）**: 緊急連絡人１に「川森郁代」が出力される
- **29190347（丹羽永吉）**: 保証人１に「丹羽進二」が出力される

## 作成日

2026-01-29

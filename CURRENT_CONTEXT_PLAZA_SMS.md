# 開発状況引き継ぎ - プラザSMS実装準備完了

## 🎉 前回セッションで完了した作業

### 1. **app.py共通化 完了** ✅
- ログ表示・フィルタ条件表示の共通化
- 約200行削減、保守性向上
- PR #32 マージ済み

### 2. **Blue-Greenデプロイ問題の特定** ✅
- 原因: docker-compose.prod.yml の `:ro` マウント
- 解決策: docker exec による直接更新
- 詳細ガイド: `NGINX_BLUEGREEN_FIX_GUIDE.md` 作成済み
- 実施: 業務時間外に予定

### 3. **プラザSMS仕様の理解** ✅
- プラザ契約者SMSの特殊要件を把握
- ヘッダー情報を `plaza_sms_call_center_headers.txt` に保存

## 📋 次の実装内容: プラザ契約者SMS

### 仕様詳細

#### 入力（2ファイル必須）
1. **ContractList.csv** - 基本データ
2. **YYYY年MM月コールセンター回収委託.csv** - 国籍情報

#### 出力（2ファイル）
1. **MMDDプラザ契約者SMS日本** - 日本人向け
2. **MMDDプラザ契約者SMS外国** - 外国人向け

#### フィルタ条件
- 委託先法人ID → 6のみ
- 入金予定日 → 前日以前とNaN（当日除外）
- 入金予定金額 → 2,3,5,12円除外
- 回収ランク → 「弁護士介入」「死亡決定」「破産決定」除外
- 電話番号 → 固定電話・IP番号・空白を除外（携帯のみ）
- 支払期限 → 日付選択UI（他のSMSと同じ）

#### 特殊処理: 国籍によるデータ分離
```
VLOOKUP相当の処理:
ContractList B列「引継番号」 = コールセンターCSV D列「会員番号」
→ コールセンターCSV P列「国籍」を取得
→ 日本人/外国人で出力を分離
```

#### その他の処理
- 回収口座の結合（ミライルと同様）
- 物件名と部屋番号の結合（ミライルと同様）

## 🚀 実装計画

### 1. プロセッサー作成
```
processors/plaza_sms/
├── __init__.py
└── contract.py  # process_plaza_sms_contract_data()
```

### 2. app.py 実装
- `show_plaza_sms_contract()` 関数
- 2ファイルアップロードUI
- 2ファイルダウンロードUI

### 3. 今後の作業順序
1. **プラザ契約者SMS実装**（今すぐ）
2. **SMS共通化**（既存6個）
3. **プラザ保証人/連絡人SMS実装**（共通化後）

## 🛠️ 開発環境

- ローカルテスト: `streamlit run app.py --server.port=8502`
- 本番環境: https://mirail.net（Green環境で稼働中）
- リポジトリ: main ブランチ

## 📌 注意事項

- 既存のミライル・フェイスSMSは変更しない（上司承認済み）
- プラザSMSは新規実装なので自由度高い
- 文字エンコーディングに注意（CP932出力）

---

作成日時: 2025-08-29 03:30
次の作業: プラザ契約者SMS実装開始
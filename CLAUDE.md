# CLAUDE.md

このファイルはClaude Code (claude.ai/code) がこのリポジトリで作業する際のガイドです。

## 🌟 プロジェクト概要

**Business Data Processor** - 不動産管理業務データ処理システム

不動産管理業務における契約データの変換・統合処理を自動化するStreamlit製のWebアプリケーション。

## 📁 主要ディレクトリ構造

```
business-data-processor/
├── app.py                        # エントリポイント（159行）
├── components/                   # UI共通コンポーネント
├── screens/                      # 画面モジュール（Phase 2完了）
│   ├── mirail_autocall.py       # ミライルオートコール
│   ├── faith_autocall.py        # フェイスオートコール
│   ├── plaza_autocall.py        # プラザオートコール
│   ├── sms/                     # SMS系画面
│   ├── registration/            # 新規登録系画面
│   └── others/                  # その他画面
├── processors/                   # データ処理モジュール
│   ├── mirail_autocall/         # ミライル（6種類）
│   ├── faith_autocall/          # フェイス（3種類）
│   ├── plaza_autocall/          # プラザ（3種類）
│   ├── mirail_sms/              # ミライルSMS
│   ├── faith_sms/               # フェイスSMS
│   ├── plaza_sms/               # プラザSMS
│   ├── sms_common/              # SMS共通処理
│   └── *_registration.py        # 新規登録プロセッサ（アーク、プラザ、ナップ等）
└── templates/                   # テンプレートファイル
```

## 🔧 技術仕様

- **言語**: Python 3.8+
- **フレームワーク**: Streamlit 1.28+
- **データ処理**: pandas 2.0+
- **デプロイ**: 手動git pullフロー

## 📋 重要な注意事項

### CSVファイル処理
- **文字化け対応**: 必ずエンコーディング（cp932 → shift_jis → utf-8-sig）を試して解消する
- **絵文字使用禁止**: CP932エンコーディングエラーの原因となるため

### 新規登録テンプレート（111列フォーマット）
- **111列厳守**: 列数・順序・名前を一切変更しない（アーク、プラザ、ナップ等全て共通）
- **空列対応**: pandasの空列処理問題に注意（仮名前方式を使用）
- **固定値**: 各社ごとに適切な固定値を設定（クライアントCD、委託先法人ID等）

### SMS共通処理
- **入金予定日フィルター**: フェイス・ミライル・プラザ全てで有効（date_filter: 'before_today'）

## 🚀 開発ルール

1. **新機能追加時**: 適切なscreens/ディレクトリに配置
2. **プロセッサー作成**: processors/配下の適切な場所に配置
3. **app.py変更禁止**: エントリポイントのみ、ビジネスロジックは追加しない
4. **テスト必須**: 機能追加時は必ず動作確認

## 📞 サポート

- **開発者**: Takuya Tsuchiya
- **AI支援**: Claude Code (Anthropic)

## 🆕 対応システム一覧

### 新規登録
- アーク新規登録（東京・大阪・北海道・北関東）
- アークトラスト新規登録（東京）
- カプコ新規登録
- プラザ新規登録
- IOG新規登録
- **ナップ新規登録** ← 新規追加

## 🧪 テストコード厳守事項

### テストコードの品質について
- テストコードは必ず実際の機能を検証すること
- `expect(true).toBe(true)`など意味のないアサーションは絶対に書かない
- 各テストケースは具体的な入力と期待される出力を検証すること
- モックは必要最小限にとどめ、実際の動作に近い形でテストすること

### ハードコーディングの禁止
- テストを通すためだけのハードコーディングは絶対禁止
- 本番コードに`if(testmode)`などという条件分岐を入れない
- テスト用の特別な値（マジックナンバー）を本番コードに埋め込まない
- 環境変数や設定ファイルを使用して、テスト環境と本番環境を適切に分離すること

### テスト実装の原則
- テストが失敗する状態から始めること（Red-Green-Refactor）
- 境界値、異常系、エラー系も必ずテストすること
- カバレッジだけでなく実際の品質を重視すること
- テストケース名は何をテストしているのか明確に記述すること

### 実装前の確認
- 機能の仕様を正しく理解してからテストを書くこと
- 不明な点があれば仮の実装ではなくユーザーに確認すること

## 🔄 標準開発フロー

### 開発チェックリスト（必須表示）

**機能追加・修正時は、以下のチェックリストを必ず表示して進捗を報告すること：**

| ステップ                             | 状態 |
|--------------------------------------|------|
| 要件定義書・設計書・タスクリスト作成 | ⬜   |
| 開発ブランチ作成                     | ⬜   |
| TDD Red（テスト先行、失敗確認）      | ⬜   |
| TDD Green（最小限の実装）            | ⬜   |
| TDD Refactor（コード整理）           | ⬜   |
| ruff check/format                    | ⬜   |
| コミット・PR作成                     | ⬜   |

※ 各ステップ完了時に ⬜ → ✅ に更新して報告

### 開発開始前
1. `git status`でクリーンな状態を確認
2. `git checkout -b feature/機能名` で開発ブランチを作成

### TDD（テスト駆動開発）
1. **Red**: テストを先に書き、失敗することを確認
2. **Green**: 最小限の実装でテストを通す
3. **Refactor**: コードを整理（テストは通ったまま）

### コード品質チェック
- `ruff check .` でリントチェック
- `ruff format .` で自動フォーマット

### コミット・PR
1. 適切な粒度でコミット（1機能1コミット推奨）
2. PRはテンプレートに従って作成
3. テストが全て通ることを確認してからマージ
4. マージは手動で実施

### ドキュメント
- 新機能追加時は要件定義・設計書を作成
- 計画ファイルは `~/.claude/plans/` に保存

---
最終更新: 2026-02-03